<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>An√∫nciate</title>
    <link href="https://fonts.googleapis.com/css?family=Poppins" rel="stylesheet">
    <style>
        :root{
            --accent:#365cab;
            --muted:#6b7280;
            --card-bg:#fff;
            --radius:10px;
        }
        body{
            font-family:Poppins, Arial, sans-serif;
            max-width:760px;
            margin:120px auto 60px;
            padding:20px;
            color:#222;
        }
        h1{font-size:28px;margin-bottom:10px}
        p{color:#555;line-height:1.6}
        
        /* ---------- OPTIONS ---------- */
        .options{
            display:flex;
            gap:30px;
            margin-top:40px;
        }
        .option{
            flex:1;
            background:#f8fafc;
            border-radius:12px;
            padding:30px;
            text-align:center;
            cursor:pointer;
            box-shadow:0 8px 24px rgba(0,0,0,.05);
            opacity:0;
        }
        .option.left{animation:slideLeft .6s forwards}
        .option.right{animation:slideRight .6s forwards}
        @keyframes slideLeft{
            from{transform:translateX(-40px);opacity:0}
            to{transform:none;opacity:1}
        }
        @keyframes slideRight{
            from{transform:translateX(40px);opacity:0}
            to{transform:none;opacity:1}
        }
        .option h2{margin-bottom:10px}
        
        /* ---------- DISCLAIMER ---------- */
        #disclaimer{
            display:none;
            margin-top:40px;
            background:#f8fafc;
            padding:30px;
            border-radius:12px;
        }
        #disclaimer label{display:flex;gap:10px;align-items:flex-start}
        
        /* ---------- FORM ---------- */
        #formWrapper{display:none;margin-top:40px}
        table{
            width:100%;
            background:var(--card-bg);
            border-radius:14px;
            box-shadow:0 10px 30px rgba(0,0,0,.06);
        }
        td{padding:22px;vertical-align:top}
        .field{margin-bottom:14px}
        .label{
            font-size:12px;
            color:var(--muted);
            text-transform:uppercase;
            letter-spacing:.5px;
        }
        input, textarea{
            width:100%;
            border:1px solid #ddd;
            border-radius:8px;
            padding:10px;
            font-family:Poppins;
        }
        textarea{resize:vertical}
        button{
            background:var(--accent);
            color:#fff;
            border:none;
            padding:14px 22px;
            border-radius:10px;
            font-weight:600;
            cursor:pointer;
            margin-top:20px;
        }
        
        /* ---------- HORARIOS ---------- */
        .schedule-section {
            margin-top: 30px;
            background: #f8fafc;
            border-radius: 12px;
            padding: 20px;
        }
        .schedule-section h3 {
            margin-top: 0;
            margin-bottom: 20px;
        }
        .day-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e5e7eb;
        }
        .day-row:last-child {
            border-bottom: none;
        }
        .day-label {
            width: 100px;
            font-weight: 500;
        }
        .time-inputs {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
        }
        .time-inputs input {
            width: 80px;
            text-align: center;
        }
        .closed-check {
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
        }
        .closed-check input {
            width: auto;
        }
        
        /* ---------- PREVIEW ---------- */
        #previewWrapper{
            display:none;
            margin-top:40px;
        }
        .preview-image-container {
            width: 100%;
            max-width: 350px;
            margin: 6px 0 0;
        }
        .full-image {
            width: 100%;
            height: 250px;
            border-radius: 10px;
            object-fit: cover;
            display: block;
            box-shadow: 0 8px 20px rgba(15,23,42,0.06);
            border: 1px solid rgba(0,0,0,0.03);
        }
        .schedule-preview {
            margin-top: 20px;
            background: #f8fafc;
            border-radius: 10px;
            padding: 15px;
        }
        .schedule-day {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e5e7eb;
        }
        .schedule-day:last-child {
            margin-bottom: 0;
            border-bottom: none;
        }
        .day-name {
            font-weight: 500;
            color: #374151;
        }
        .day-schedule {
            color: #6b7280;
        }
        .closed {
            color: #ef4444;
        }
        
        /* ---------- MODAL ---------- */
        #confirmModal{
            display:none;
            position:fixed;
            inset:0;
            background:rgba(0,0,0,.4);
            align-items:center;
            justify-content:center;
        }
        .modal{
            background:#fff;
            padding:30px;
            border-radius:12px;
            max-width:400px;
            text-align:center;
        }
        .modal button{margin:10px}
        #legalBox{
            max-height:220px;
            overflow-y:auto;
            padding:16px;
            border:1px solid #ddd;
            border-radius:8px;
            background:#fff;
            font-size:14px;
            line-height:1.6;
        }
        #acceptBtn:disabled{
            opacity:.4;
            cursor:not-allowed;
        }


        /* HEADER ‚Äì estado inicial (color base #365cab) */
.main-header {
  width: 100%;
  padding: 20px 40px;
  box-sizing: border-box;
  position: fixed;
  top: 0;
  left: 0;
  z-index: 2000;

  background: #365cab;         /* color base solicitado */
  backdrop-filter: none;       
  transition: background 0.25s ease, backdrop-filter 0.25s ease, padding 0.25s ease;
}

.nav-container {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.nav-logo img {
  width: 42px;
  height: auto;
  cursor: pointer;
  filter: none !important;    /* logo blanco tal cual, sin invertir */
}

.nav-links {
  list-style: none;
  display: flex;
  gap: 28px;
  padding: 0;
  margin: 0;
}

.nav-links li a {
  color: white;               /* texto blanco en estado base */
  font-family: Poppins, sans-serif;
  font-size: 16px;
  text-decoration: none;
  font-weight: 500;
  transition: opacity 0.2s ease, color 0.25s ease;
}

.nav-links li a:hover {
  opacity: 0.7;
}

/* ESTADO SCROLLED (igual que index.html) */
.main-header.scrolled {
  background: rgba(255,255,255,0.5);  /* igual que en index */
  backdrop-filter: blur(8px);
  padding: 12px 40px;
  border-bottom: 1px solid rgba(255,255,255,0.25);
}

/* Cuando el header pasa a fondo claro ‚Üí texto oscuro */
.main-header.scrolled .nav-links li a {
  color: #222;
}

/* Logo pasa de blanco ‚Üí negro al hacer scroll (igual que index.html) */
.main-header.scrolled .nav-logo img {
  filter: brightness(0) invert(1);
}


    /* FOOTER - ancho completo */
    #main-footer {
      background: #365cab;
      color: white;
      padding: 50px 0 30px 0;
      width: 100vw;
      margin-left: calc(50% - 50vw);
      margin-right: calc(50% - 50vw);
    }

    .footer-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .footer-disclaimer {
      text-align: center;
      margin-top: 30px;
      font-size: 14px;
      opacity: 0.85;
    }

    .footer-right a {
      margin-left: 20px;
      color: white !important;
      font-weight: 600;
      text-decoration: none;
    }

    .footer-right a:hover {
      text-decoration: underline;
    }

    .footer-left .footer-contact a {
      color: white !important;
      text-decoration: underline;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .footer-container {
        flex-direction: column;
        text-align: center;
        gap: 20px;
      }

      .footer-right a {
        margin-left: 10px;
        margin-right: 10px;
      }

      .thumb { width: 120px; height: 120px; }
    }

    .s01 .header-block {
      width: 100%;
      display: block;
      text-align: center;
      margin-bottom: 40px;
    }

        
    /* =========================================== */
/* ESPACIADO PARA EL FOOTER - A√ëADE ESTO */
/* =========================================== */

/* 1. M√°s espacio debajo del contenido principal */
body {
  margin: 120px auto 100px !important; /* Aumenta el margen inferior */
}

/* 2. Contenedor de separaci√≥n antes del footer */
#footer-placeholder {
  margin-top: 80px;
  display: block;
}

/* 3. Asegurar que el contenido no quede detr√°s del header fijo */
body {
  padding-top: 20px; /* Ya lo tienes, est√° bien */
}

/* 4. Ajuste para la previsualizaci√≥n (si es necesario) */
#previewWrapper {
  padding-bottom: 40px; /* Espacio extra en la previsualizaci√≥n */
}

        /* =================================================== */
/* ESTILOS PARA LAS NUEVAS SECCIONES DEL FORMULARIO */
/* =================================================== */

/* Secciones diferenciadas */
.form-section,
.applicant-section {
  background: #f8fafc;
  border-radius: 14px;
  padding: 30px;
  margin-bottom: 30px;
  border: 1px solid #e5e7eb;
}

/* Encabezados de secci√≥n */
.form-section h3,
.applicant-section h3,
.schedule-section h3 {
  font-size: 20px;
  margin-top: 0;
  margin-bottom: 25px;
  color: #374151;
  display: flex;
  align-items: center;
  gap: 10px;
}

/* Secci√≥n del solicitante con fondo diferenciado */
.applicant-section {
  background: #f0f7ff; /* Azul muy suave */
  border: 1px solid #dbeafe;
  border-left: 4px solid #365cab; /* Acento azul */
}

/* Descripci√≥n de la secci√≥n */
.section-description {
  color: #6b7280;
  font-size: 14px;
  margin-top: -15px;
  margin-bottom: 25px;
  line-height: 1.5;
}

/* Campos requeridos visualmente */
.field input:required,
.field textarea:required {
  border-left: 3px solid #365cab;
}

/* Indicador de campo obligatorio */
.label:has(+ input:required)::after,
.label:has(+ textarea:required)::after {
  content: " *";
  color: #ef4444;
}

/* Ajuste del contenedor de horarios para no duplicar estilos */
.schedule-section {
  background: #f8fafc;
  border-radius: 14px;
  padding: 30px;
  margin-bottom: 30px;
}

/* Mejora de los campos existentes */
.field {
  margin-bottom: 20px;
}

.field .label {
  font-size: 13px;
  color: #6b7280;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 6px;
  display: block;
  font-weight: 500;
}

.field input,
.field textarea {
  width: 100%;
  border: 1px solid #d1d5db;
  border-radius: 8px;
  padding: 12px 14px;
  font-family: Poppins, Arial, sans-serif;
  font-size: 15px;
  transition: all 0.2s ease;
  box-sizing: border-box;
}

.field input:focus,
.field textarea:focus {
  outline: none;
  border-color: #365cab;
  box-shadow: 0 0 0 3px rgba(54, 92, 171, 0.1);
}

        /* =================================================== */
/* TOOLTIPS PARA FORMULARIO */
/* =================================================== */

.field {
  position: relative;
  margin-bottom: 20px;
}

/* Icono de informaci√≥n */
.field .label {
  display: flex;
  align-items: center;
  gap: 6px;
}

.info-icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 16px;
  height: 16px;
  background: #365cab;
  color: white;
  border-radius: 50%;
  font-size: 11px;
  cursor: help;
  font-weight: bold;
  position: relative;
}

/* Tooltip */
.tooltip {
  position: absolute;
  background: #1f2937;
  color: white;
  padding: 10px 14px;
  border-radius: 8px;
  font-size: 13px;
  width: 250px;
  z-index: 1000;
  opacity: 0;
  visibility: hidden;
  transform: translateY(10px);
  transition: all 0.2s ease;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  pointer-events: none;
}

.tooltip::before {
  content: '';
  position: absolute;
  top: -6px;
  left: 20px;
  border-width: 0 6px 6px 6px;
  border-style: solid;
  border-color: transparent transparent #1f2937 transparent;
}

.info-icon:hover + .tooltip {
  opacity: 1;
  visibility: visible;
  transform: translateY(0);
}


@media (max-width: 768px) {
  .tooltip {
    width: 200px;
    font-size: 12px;
  }
}

/* =================================================== */
/* HORARIOS CON DOS FRANJAS */
/* =================================================== */
.time-slot {
  display: flex;
  align-items: center;
  gap: 4px;
}

.time-inputs {
  display: flex;
  align-items: center;
  gap: 8px;
  flex: 1;
  flex-wrap: wrap;
}

.time-inputs input[type="time"] {
  width: 75px;
  text-align: center;
  padding: 6px 4px;
}

/* Ajustes responsive para horarios */
@media (max-width: 768px) {
  .time-inputs {
    flex-direction: column;
    align-items: flex-start;
    gap: 8px;
  }
  
  .time-slot {
    width: 100%;
    justify-content: flex-start;
  }
}

        /* Tooltip mejorado */
.info-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 16px;
    height: 16px;
    background: #365cab;
    color: white;
    border-radius: 50%;
    font-size: 11px;
    cursor: help;
    font-weight: bold;
    position: relative;
    margin-left: 6px;
    vertical-align: middle;
}

/* Posicionamiento del tooltip relativo al info-icon */
.label {
    position: relative;
}

.tooltip {
    position: absolute;
    background: #1f2937;
    color: white;
    padding: 10px 14px;
    border-radius: 8px;
    font-size: 13px;
    width: 250px;
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transform: translateY(10px);
    transition: all 0.2s ease;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    pointer-events: none;
    top: 100%;
    left: 0;
    margin-top: 8px;
}

/* Flecha del tooltip */
.tooltip::before {
    content: '';
    position: absolute;
    top: -6px;
    left: 12px;
    border-width: 0 6px 6px 6px;
    border-style: solid;
    border-color: transparent transparent #1f2937 transparent;
}

/* Mostrar tooltip al hacer hover sobre el info-icon */
.info-icon:hover + .tooltip {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
}

/* Ajuste para mobile */
@media (max-width: 768px) {
    .tooltip {
        width: 200px;
        font-size: 12px;
        left: -50px;
    }
    
    .tooltip::before {
        left: 60px;
    }
}
    </style>

</head>
<body>

    <!-- Header -->
  <div id="header-placeholder"></div>
  <script>
    fetch("header.html")
      .then(r => r.text())
      .then(html => {
        document.getElementById("header-placeholder").innerHTML = html;
      })
      .catch(e => console.error("No se pudo cargar header:", e));
  </script>
    <h1>An√∫nciate</h1>
    <p><b>Publica tu negocio gratis y mejora tu visibilidad online.</b> Aparecer en nuestro buscador local te ayuda a conectar con clientes de tu zona. Solo tienes que rellenar el formulario con los datos de tu negocio ¬°El resto d√©janoslo a nosotros!</p>
    
    <div class="options" id="options">
        <div class="option left" id="addBtn">
            <h2>Anunciar mi negocio</h2>
            <p>Publica tu ficha gratuitamente</p>
        </div>
        <div class="option right">
            <h2>Modificar mi anuncio</h2>
            <p>Pr√≥ximamente</p>
        </div>
    </div>
    
    <!-- DISCLAIMER -->
    <div id="disclaimer">
        <div id="legalBox">
            <h3>Informaci√≥n sobre protecci√≥n de datos y consentimiento</h3>
            <p>
                De conformidad con lo establecido en el Reglamento (UE) 2016/679 (Reglamento General de Protecci√≥n de Datos) y la normativa vigente en materia de protecci√≥n de datos, le informamos de que los datos personales que facilite a trav√©s de este formulario ser√°n tratados por LocalStore, como responsable del tratamiento, con la finalidad de atender su solicitud, gestionar la relaci√≥n comercial y enviarle comunicaciones informativas y promocionales relacionadas con nuestros productos, servicios, actividades o iniciativas vinculadas al negocio.
            </p>
            <p>
                El tratamiento de sus datos se basa en el consentimiento expreso otorgado mediante la aceptaci√≥n de la presente cl√°usula, consentimiento que podr√° retirar en cualquier momento sin que ello afecte a la licitud del tratamiento previo a su retirada.
            </p>
            <p>
                Sus datos no ser√°n cedidos a terceros, salvo en los casos en que exista una obligaci√≥n legal, y se conservar√°n durante el tiempo estrictamente necesario para cumplir con la finalidad para la que fueron recabados o mientras exista un inter√©s leg√≠timo o consentimiento v√°lido.
            </p>
            <p>
                Asimismo, le informamos de que puede ejercer en cualquier momento sus derechos de acceso, rectificaci√≥n, supresi√≥n, limitaci√≥n del tratamiento, oposici√≥n y portabilidad de sus datos, enviando una solicitud junto con una copia de un documento identificativo a localstore@mail.com.
            </p>
            <p>
                Al enviar este formulario, usted declara haber le√≠do y comprendido la presente informaci√≥n y acepta expresamente el tratamiento de sus datos personales en los t√©rminos indicados.
            </p>
        </div>
        <label style="margin-top:14px;display:flex;gap:10px;">
            <input type="checkbox" id="acceptCheck">
            <span>Acepto el tratamiento de mis datos</span>
        </label>
        <button id="acceptBtn" disabled>Continuar</button>
    </div>
    
    <!-- FORM -->
<div id="formWrapper">
    <form id="shopForm">
        <table>
            <tr>
                <td>
                    <!-- DATOS DEL NEGOCIO -->
                    <div class="form-section">
                        <h3>üìã Datos del negocio</h3>
                        
                        <div class="field">
                            <div class="label">Nombre del negocio *</div>
                            <input name="name" required>
                        </div>
                        <div class="field">
                            <div class="label">Imagen del negocio</div>
                            <input type="file" name="image" id="imageInput" accept="image/*">
                        </div>
                        <div class="field">
    <div class="label">
        Categor√≠a *
        <span class="info-icon">?</span>
        <div class="tooltip">Ejemplo: Panader√≠a, Mercer√≠a, Academia...</div>
    </div>
    <input name="category" required>
</div>
                        <div class="field">
                            <div class="label">Direcci√≥n *</div>
                            <input name="address" required>
                        </div>
                        <div class="field">
                            <div class="label">Tel√©fono</div>
                            <input name="phone">
                        </div>
                        <div class="field">
                            <div class="label">Email del negocio</div>
                            <input name="email" type="email">
                        </div>
                        <div class="field">
                            <div class="label">Sitio web</div>
                            <input name="website">
                        </div>
                        <div class="field">
                            <div class="label">Descripci√≥n</div>
                            <textarea name="description" rows="4"></textarea>
                        </div>
                    </div>
                </td>
            </tr>
        </table>
        
        <!-- HORARIOS -->
        <div class="schedule-section">
            <h3>üïê Horario de atenci√≥n</h3>
            <div id="scheduleFields">
                <!-- Los d√≠as se generar√°n con JavaScript -->
            </div>
        </div>
        
        <!-- DATOS DEL SOLICITANTE (NUEVA SECCI√ìN) -->
        <div class="applicant-section">
            <h3>üë§ Tus datos de contacto</h3>
            <p class="section-description">Te notificaremos aqu√≠ la recepci√≥n y resoluci√≥n de tu solicitud.</p>
            
            <div class="field">
                <div class="label">Tu nombre completo *</div>
                <input name="applicant_name" required>
            </div>
            <div class="field">
                <div class="label">Tu correo electr√≥nico *</div>
                <input name="applicant_email" type="email" required>
            </div>
            
        </div>
        
        <button type="button" id="previewBtn">Previsualizar</button>
    </form>
</div>
    
    <!-- PREVIEW -->
    <div id="previewWrapper" style="display:none;margin-top:40px;">
        <h1 id="previewName"></h1>
        <table id="shopLayout">
            <tr>
                <td id="leftCol">
                    <div id="previewData"></div>
                </td>
                <td id="rightCol">
                    <div id="previewImage"></div>
                    <div id="previewSchedule" class="schedule-preview"></div>
                </td>
            </tr>
        </table>
        <div style="margin-top:24px;display:flex;gap:14px;">
            <button id="editBtn">Modificar</button>
            <button id="finalSubmitBtn">Enviar solicitud</button>
        </div>
    </div>
    
    <!-- CONFIRM MODAL -->
    <div id="confirmModal">
        <div class="modal">
            <p>¬øEst√°s seguro de enviar este anuncio?</p>
            <button id="confirmYes">S√≠, enviar</button>
            <button onclick="closeModal()">Cancelar</button>
        </div>
    </div>
<div id="footer-placeholder"></div>

  <script>
    // Cargar footer.html din√°micamente
    fetch("footer.html")
      .then(res => res.text())
      .then(html => {
        document.getElementById("footer-placeholder").innerHTML = html;
      })
      .catch(err => console.error("No se pudo cargar el footer:", err));
  </script>
    <script>
        // Disclaimer logic
        const legalBox = document.getElementById("legalBox");
        const acceptCheck = document.getElementById("acceptCheck");
        const acceptBtn = document.getElementById("acceptBtn");
        let scrolledToBottom = false;

        function updateButtonState(){
            acceptBtn.disabled = !(scrolledToBottom && acceptCheck.checked);
        }

        legalBox.addEventListener("scroll", () => {
            const tolerance = 5;
            if (legalBox.scrollTop + legalBox.clientHeight >= legalBox.scrollHeight - tolerance) {
                scrolledToBottom = true;
                updateButtonState();
            }
        });

        acceptCheck.addEventListener("change", updateButtonState);

        acceptBtn.onclick = () => {
            document.getElementById("disclaimer").style.display = "none";
            document.getElementById("formWrapper").style.display = "block";
            generateScheduleFields();
        };

        // Show disclaimer
        const addBtn = document.getElementById("addBtn");
        const options = document.getElementById("options");
        const disclaimer = document.getElementById("disclaimer");

        addBtn.addEventListener("click", () => {
            options.style.display = "none";
            disclaimer.style.display = "block";
        });

        
        // Generate schedule fields
function generateScheduleFields() {
    const scheduleFields = document.getElementById("scheduleFields");
    const days = [
        { id: 'monday', name: 'Lunes' },
        { id: 'tuesday', name: 'Martes' },
        { id: 'wednesday', name: 'Mi√©rcoles' },
        { id: 'thursday', name: 'Jueves' },
        { id: 'friday', name: 'Viernes' },
        { id: 'saturday', name: 'S√°bado' },
        { id: 'sunday', name: 'Domingo' }
    ];

    scheduleFields.innerHTML = '';

    days.forEach(day => {
        const dayRow = document.createElement('div');
        dayRow.className = 'day-row';
        dayRow.innerHTML = `
            <div class="day-label">${day.name}</div>
            <div class="time-inputs">
                <!-- MA√ëANA -->
                <div class="time-slot">
                    <input type="time" id="${day.id}_morning_open" name="${day.id}_morning_open" 
                           data-day="${day.id}" data-slot="morning" data-type="open" 
                           placeholder="09:00" step="900" list="minuteOptions">
                    <span>a</span>
                    <input type="time" id="${day.id}_morning_close" name="${day.id}_morning_close" 
                           data-day="${day.id}" data-slot="morning" data-type="close" 
                           placeholder="13:00" step="900" list="minuteOptions">
                </div>
                <span style="color:#999; margin:0 5px;">|</span>
                <!-- TARDE -->
                <div class="time-slot">
                    <input type="time" id="${day.id}_afternoon_open" name="${day.id}_afternoon_open" 
                           data-day="${day.id}" data-slot="afternoon" data-type="open" 
                           placeholder="16:00" step="900" list="minuteOptions">
                    <span>a</span>
                    <input type="time" id="${day.id}_afternoon_close" name="${day.id}_afternoon_close" 
                           data-day="${day.id}" data-slot="afternoon" data-type="close" 
                           placeholder="20:00" step="900" list="minuteOptions">
                </div>
            </div>
            <div class="closed-check">
                <input type="checkbox" id="${day.id}_closed" name="${day.id}_closed">
                <label for="${day.id}_closed">Cerrado</label>
            </div>
        `;
        scheduleFields.appendChild(dayRow);

        // Add event listeners for closed checkbox
        const closedCheck = document.getElementById(`${day.id}_closed`);
        const timeInputs = dayRow.querySelectorAll('input[type="time"]');

        closedCheck.addEventListener('change', function() {
            timeInputs.forEach(input => {
                input.disabled = this.checked;
                if (this.checked) input.value = '';
            });
        });

        // Mejor control de minutos (00, 15, 30, 45)
        timeInputs.forEach(input => {
            input.addEventListener('input', function() {
                if (this.value) {
                    const [hours, minutes] = this.value.split(':');
                    if (minutes && !['00', '15', '30', '45'].includes(minutes)) {
                        // Encontrar el minuto m√°s cercano v√°lido
                        const minuteNum = parseInt(minutes);
                        let validMinute;
                        
                        if (minuteNum < 7) validMinute = '00';
                        else if (minuteNum < 22) validMinute = '15';
                        else if (minuteNum < 37) validMinute = '30';
                        else if (minuteNum < 52) validMinute = '45';
                        else {
                            // Si es > 52, sumar 1 hora y poner 00
                            const hourNum = parseInt(hours) + 1;
                            this.value = `${hourNum.toString().padStart(2, '0')}:00`;
                            return;
                        }
                        
                        this.value = `${hours}:${validMinute}`;
                    }
                }
            });

            // Tambi√©n validar al perder el foco
            input.addEventListener('blur', function() {
                if (this.value) {
                    const [hours, minutes] = this.value.split(':');
                    if (minutes && !['00', '15', '30', '45'].includes(minutes)) {
                        const minuteNum = parseInt(minutes);
                        let validMinute;
                        
                        if (minuteNum < 7) validMinute = '00';
                        else if (minuteNum < 22) validMinute = '15';
                        else if (minuteNum < 37) validMinute = '30';
                        else if (minuteNum < 52) validMinute = '45';
                        else {
                            const hourNum = parseInt(hours) + 1;
                            this.value = `${hourNum.toString().padStart(2, '0')}:00`;
                            return;
                        }
                        
                        this.value = `${hours}:${validMinute}`;
                    }
                }
            });
        });
    });
}

        // Preview logic
        const previewBtn = document.getElementById("previewBtn");
        const formWrapper = document.getElementById("formWrapper");
        const previewWrapper = document.getElementById("previewWrapper");
        const imageInput = document.getElementById("imageInput");

        previewBtn.addEventListener("click", () => {
            const form = document.getElementById("shopForm");
            const data = new FormData(form);

            // Nombre
            document.getElementById("previewName").textContent = data.get("name") || "Sin nombre";

            // Campos
            document.getElementById("previewData").innerHTML = 
                `${renderPreviewField("Categor√≠a", data.get("category"))}
                 ${renderPreviewField("Ubicaci√≥n", data.get("address"))}
                 ${renderPreviewField("Tel√©fono", data.get("phone"))}
                 ${renderPreviewLink("Email", data.get("email"), "mailto:" + data.get("email"))}
                 ${renderPreviewLink("Web", data.get("website"), data.get("website"))}
                 ${renderPreviewField("Descripci√≥n", data.get("description"))}`;

            // Imagen con tama√±o fijo
            const file = imageInput.files[0];
            if (file) {
                const url = URL.createObjectURL(file);
                document.getElementById("previewImage").innerHTML = 
                    `<div class="preview-image-container">
                        <img src="${url}" class="full-image">
                    </div>`;
            } else {
                document.getElementById("previewImage").innerHTML = 
                    `<div class="preview-image-container">
                        <div style="color:#999; text-align:center; padding: 20px;">Sin imagen</div>
                    </div>`;
            }

            // Horarios en previsualizaci√≥n
            const scheduleData = getScheduleData();
            document.getElementById("previewSchedule").innerHTML = 
                `<h3 style="margin-top: 0; margin-bottom: 15px;">Horario</h3>
                 ${renderSchedulePreview(scheduleData)}`;

            formWrapper.style.display = "none";
            previewWrapper.style.display = "block";
        });

        // Get schedule data from form
        // Get schedule data from form (ahora con dos franjas)
function getScheduleData() {
    const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
    const schedule = {};
    
    days.forEach(day => {
        const closedCheck = document.getElementById(`${day}_closed`);
        if (closedCheck && closedCheck.checked) {
            schedule[day] = [];
        } else {
            const morningOpen = document.getElementById(`${day}_morning_open`).value;
            const morningClose = document.getElementById(`${day}_morning_close`).value;
            const afternoonOpen = document.getElementById(`${day}_afternoon_open`).value;
            const afternoonClose = document.getElementById(`${day}_afternoon_close`).value;
            
            const timeSlots = [];
            
            if (morningOpen && morningClose) {
                timeSlots.push({ open: morningOpen, close: morningClose });
            }
            
            if (afternoonOpen && afternoonClose) {
                timeSlots.push({ open: afternoonOpen, close: afternoonClose });
            }
            
            schedule[day] = timeSlots;
        }
    });
    
    return schedule;
}

        // Render schedule preview
        // Render schedule preview (actualizado para dos franjas)
function renderSchedulePreview(schedule) {
    const dayNames = {
        monday: 'Lunes',
        tuesday: 'Martes',
        wednesday: 'Mi√©rcoles',
        thursday: 'Jueves',
        friday: 'Viernes',
        saturday: 'S√°bado',
        sunday: 'Domingo'
    };

    let html = '';
    
    Object.entries(schedule).forEach(([day, times]) => {
        let scheduleText = '';
        
        if (times.length === 0) {
            scheduleText = '<span class="closed">Cerrado</span>';
        } else {
            scheduleText = times.map(time => 
                `${time.open} - ${time.close}`
            ).join(' y ');
        }
        
        html += `
            <div class="schedule-day">
                <div class="day-name">${dayNames[day]}</div>
                <div class="day-schedule">${scheduleText}</div>
            </div>
        `;
    });
    
    return html;
}
// ============================================================
// FUNCI√ìN PARA SUBIR LA IMAGEN A CLOUDINARY (VERSI√ìN VERCELL)
// ============================================================
async function uploadImageToService(imageFile) {
    // Convertir la imagen a base64 (formato que espera nuestra funci√≥n)
    const toBase64 = file => new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
        reader.onerror = error => reject(error);
    });

    try {
        const imageBase64 = await toBase64(imageFile);
        
        // Enviar a la funci√≥n de Vercel
        const response = await fetch('/api/upload-cloudinary', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ image: imageBase64 })
        });
        
        const result = await response.json();
        
        if (result.success) {
            return result.link;
        } else {
            console.error('Error desde la API:', result.error);
            return null;
        }
    } catch (error) {
        console.error('Error de red:', error);
        return null;
    }
}
        // Bot√≥n Modificar
        document.getElementById("editBtn").addEventListener("click", () => {
            previewWrapper.style.display = "none";
            formWrapper.style.display = "block";
        });

     // ============================================================
// BOT√ìN "ENVIAR SOLICITUD" - VERSI√ìN CON CLOUDINARY
// ============================================================
document.getElementById("finalSubmitBtn").addEventListener("click", async () => {
    const submitBtn = document.getElementById("finalSubmitBtn");
    const originalText = submitBtn.textContent;

    // Deshabilitar el bot√≥n para evitar m√∫ltiples env√≠os
    submitBtn.disabled = true;
    submitBtn.textContent = "Enviando...";

    try {
        // 1. RECOLECTAR DATOS DEL FORMULARIO Y HORARIOS
        const form = document.getElementById("shopForm");
        const formData = new FormData(form);
        const scheduleData = getScheduleData();

        // 2. SUBIR LA IMAGEN A CLOUDINARY (si existe) Y OBTENER SU URL
        const imageFile = document.getElementById("imageInput").files[0];
        let imageUrl = ""; // Inicializamos la variable para el enlace

        if (imageFile) {
            // Validar tama√±o (~10MB l√≠mite com√∫n, ajusta si quieres)
            const fileSizeMB = imageFile.size / (1024 * 1024);
            if (fileSizeMB > 10) {
                alert(`‚ö†Ô∏è La imagen es muy grande (${fileSizeMB.toFixed(1)}MB). Por favor, compr√≠mela a menos de 10MB.`);
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
                return;
            }
            // LLAMAR A LA FUNCI√ìN QUE SUBE LA IMAGEN
            imageUrl = await uploadImageToService(imageFile);
            if (!imageUrl) {
                // Si uploadImageToService devuelve null, hubo un error
                alert("‚ö†Ô∏è No se pudo subir la imagen. El env√≠o continuar√° sin ella.");
                // No detenemos el env√≠o, solo continuamos sin la URL de la imagen.
            }
        }

        // 3. CONSTRUIR OBJETO DE DATOS PARA WEB3FORMS (¬°SIN ADJUNTAR EL ARCHIVO!)
        const dataForEmail = {
            access_key: "e914a7b1-7805-4c73-bb65-d2cc8cd6a5d5",
            subject: `üìÑ Nueva Solicitud de Anuncio: ${formData.get("name") || "Sin nombre"}`,
            from_name: "Formulario LocalStore",

            // Mapear campos del formulario
            "üè¢ **Nombre del Negocio**": formData.get("name"),
            "üìÇ **Categor√≠a**": formData.get("category"),
            "üìç **Direcci√≥n**": formData.get("address"),
            "üìû **Tel√©fono**": formData.get("phone"),
            "‚úâÔ∏è **Email**": formData.get("email"),
            "üåê **Sitio Web**": formData.get("website"),
            "üìù **Descripci√≥n**": formData.get("description"),
                // NUEVOS CAMPOS DEL SOLICITANTE
            "üë§ **Solicitante**": formData.get("applicant_name"),
            "üìß **Email del solicitante**": formData.get("applicant_email"),
            // Incluir el enlace a la imagen (o un mensaje indicando que no hay)
            "üñºÔ∏è **Enlace a la Imagen**": imageUrl || "No se subi√≥ ninguna imagen.",

            // Convertir horarios a texto legible para el correo
            "üïê **Horarios**": formatScheduleForEmail(scheduleData),

            // Campo anti-spam
            botcheck: ""
        };

        // 4. ENVIAR LOS DATOS (NO EL ARCHIVO) A WEB3FORMS
        // Nota: Ahora usamos JSON, no FormData, porque no adjuntamos el archivo.
        const response = await fetch("https://api.web3forms.com/submit", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify(dataForEmail)
        });

        const result = await response.json();

        // 5. MANEJAR RESPUESTA
        if (response.status === 200) {
            alert("‚úÖ ¬°Solicitud enviada con √©xito! Te responderemos a la mayor brevedad posible. ¬°Muchas gracias por confiar en LocalStore!.");
            // Aqu√≠ puedes agregar una redirecci√≥n si lo deseas:
            // window.location.href = "gracias.html";
            // Opcional: Limpiar el formulario
            // form.reset();
            // previewWrapper.style.display = "none";
            // formWrapper.style.display = "block";

        } else {
            alert(`‚ùå Error al enviar: ${result.message || "ALgo ha ido mal. Por favor, int√©ntalo de nuevo."}`);
        }

    } catch (error) {
        console.error("Error en el proceso de env√≠o:", error);
        alert("‚ö†Ô∏è Ocurri√≥ un problema inesperado. Verifica tu conexi√≥n e intenta nuevamente.");
    } finally {
        // 6. RESTAURAR BOT√ìN
        submitBtn.disabled = false;
        submitBtn.textContent = originalText;
    }
});

// FUNCI√ìN ADICIONAL: Formatear horarios para el cuerpo del correo
function formatScheduleForEmail(schedule) {
    const dayNames = {
        monday: "Lunes",
        tuesday: "Martes",
        wednesday: "Mi√©rcoles",
        thursday: "Jueves",
        friday: "Viernes",
        saturday: "S√°bado",
        sunday: "Domingo"
    };

    let text = "";
    for (const [day, times] of Object.entries(schedule)) {
        text += `**${dayNames[day]}**: `;
        if (times.length === 0) {
            text += "Cerrado\\n";
        } else {
            text += times.map(t => `${t.open} - ${t.close}`).join(" / ") + "\\n";
        }
    }
    return text;
}
        
       

        // Helper functions para previsualizaci√≥n
        function renderPreviewField(label, value){
            if (!value) return "";
            return `<div class="field">
                <div class="label">${label}</div>
                <div class="value">${value}</div>
            </div>`;
        }

        function renderPreviewLink(label, value, href){
            if (!value) return "";
            const safe = href.startsWith("http") || href.startsWith("mailto:") ? href : "https://" + href;
            return `<div class="field">
                <div class="label">${label}</div>
                <a class="value" href="${safe}" target="_blank">${value}</a>
            </div>`;
        }

        // Modal functions
        function closeModal() {
            document.getElementById("confirmModal").style.display = "none";
        }
    </script>

    
</body>
</html>
