<!-- public/post.html -->
<!DOCTYPE html>
<html lang="es">
<head>

    <!-- En post.html, dentro de <head> -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<!-- Opcional: Para resaltado de sintaxis -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css">

    <!-- En post.html -->
<script src="/js/marked.min.js"></script>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LocalStore - Post</title>
    <link rel="stylesheet" href="/css/blog.css">
    <style>
        .post-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }
        
        .post-header {
            margin-bottom: 2rem;
        }
        
        .post-image {
            width: 100%;
            height: 400px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 2rem;
        }
        
        .post-content {
            font-size: 1.1rem;
            line-height: 1.8;
        }
        
        .post-meta {
            color: #666;
            margin-bottom: 1rem;
        }
        
        .back-link {
            display: inline-block;
            margin-bottom: 2rem;
            color: #0070f3;
            text-decoration: none;
        }
        
        .loading, .error {
            text-align: center;
            padding: 4rem;
        }
    </style>
</head>
<body>
    <div class="post-container">
        <a href="/blog.html" class="back-link">← Volver al blog</a>
        <div id="post-content">
            <div class="loading">Cargando post...</div>
        </div>
    </div>

    <script>
        // Obtener slug de la URL
        function getSlugFromURL() {
            // Para URLs como: /post/te-damos-la-bienvenida-a-localstore
            const path = window.location.pathname;
            const parts = path.split('/');
            const slug = parts[parts.length - 1];
            
            // Si estamos en post.html?slug=xxx, usar query param
            const urlParams = new URLSearchParams(window.location.search);
            const querySlug = urlParams.get('slug');
            
            return querySlug || slug;
        }
        
        async function loadPost() {
            const slug = getSlugFromURL();
            
            if (!slug || slug === 'post.html') {
                document.getElementById('post-content').innerHTML = 
                    '<div class="error">Post no encontrado</div>';
                return;
            }
            
            try {
                // OPCIÓN A: Usar tu API
                const response = await fetch(`/api/blog?slug=${encodeURIComponent(slug)}`);
                const result = await response.json();
                
                if (result.status === 'success' && result.data) {
                    renderPost(result.data);
                } else {
                    showError('Post no encontrado');
                }
                
            } catch (error) {
                console.error('Error:', error);
                showError('Error cargando el post');
            }
        }
        
        function renderPost(post) {
            document.title = `${post.title} - LocalStore`;
            
            // Actualizar meta tags para SEO
            updateMetaTags(post);
            
            const postContent = document.getElementById('post-content');
            postContent.innerHTML = `
                <article class="post">
                    <header class="post-header">
                        <h1>${post.title}</h1>
                        <div class="post-meta">
                            <span class="author">Por ${post.author}</span>
                            <span class="separator">•</span>
                            <time datetime="${post.published_at}">
                                ${formatDate(post.published_at)}
                            </time>
                        </div>
                    </header>
                    
                    ${post.thumbnail_url ? `
                        <img src="${post.thumbnail_url}" 
                             alt="${post.title}" 
                             class="post-image"
                             onerror="this.style.display='none'">
                    ` : ''}
                    
                    <div class="post-content">
                        ${formatContent(post.content)}
                    </div>
                    
                    <footer class="post-footer">
                        <a href="/blog.html" class="back-link">← Volver al blog</a>
                    </footer>
                </article>
            `;
        }
        
        function formatContent(content) {
            // Si el contenido es markdown, podrías usar una librería como marked.js
            // Por ahora, convertir saltos de línea a <br> y <p>
            return content
                .split('\n\n')
                .map(paragraph => 
                    paragraph.trim() ? `<p>${paragraph.replace(/\n/g, '<br>')}</p>` : ''
                )
                .join('');
        }
        
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('es-ES', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        function updateMetaTags(post) {
            // Actualizar meta description
            let metaDesc = document.querySelector('meta[name="description"]');
            if (!metaDesc) {
                metaDesc = document.createElement('meta');
                metaDesc.name = 'description';
                document.head.appendChild(metaDesc);
            }
            metaDesc.content = post.excerpt || post.content.substring(0, 160);
            
            // Open Graph tags para redes sociales
            const ogTags = [
                { property: 'og:title', content: post.title },
                { property: 'og:description', content: post.excerpt || '' },
                { property: 'og:type', content: 'article' },
                { property: 'og:url', content: window.location.href }
            ];
            
            if (post.thumbnail_url) {
                ogTags.push({ property: 'og:image', content: post.thumbnail_url });
            }
            
            ogTags.forEach(tag => {
                let meta = document.querySelector(`meta[property="${tag.property}"]`);
                if (!meta) {
                    meta = document.createElement('meta');
                    meta.setAttribute('property', tag.property);
                    document.head.appendChild(meta);
                }
                meta.content = tag.content;
            });
        }
        
        function showError(message) {
            document.getElementById('post-content').innerHTML = 
                `<div class="error">${message}</div>`;
        }
        
        // Iniciar cuando el DOM esté listo
        document.addEventListener('DOMContentLoaded', loadPost);
    </script>
</body>
</html>
