<!-- blog.html -->
<script type="module">
  import { fetchPosts, renderFeaturedPost, renderPostCard, initBlog } from './api/blog.js';
  
  async function loadBlog() {
    // Inicializar y verificar conexión
    const isConnected = await initBlog();
    if (!isConnected) {
      document.getElementById('blog-container').innerHTML = 
        '<p class="error">Error conectando con el blog</p>';
      return;
    }
    
    // Cargar posts
    const { data: posts, error } = await fetchPosts();
    
    if (error) {
      console.error('Error:', error);
      return;
    }
    
    if (posts && posts.length > 0) {
      // Post destacado (el más reciente)
      const featuredPost = posts[0];
      document.getElementById('featured-post').innerHTML = renderFeaturedPost(featuredPost);
      
      // Historial (resto de posts)
      const historyPosts = posts.slice(1);
      document.getElementById('post-history').innerHTML = 
        historyPosts.map(post => renderPostCard(post)).join('');
    } else {
      document.getElementById('featured-post').innerHTML = 
        '<p>No hay posts publicados todavía.</p>';
    }
  }
  
  // Cargar cuando el DOM esté listo
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', loadBlog);
  } else {
    loadBlog();
  }
</script>
